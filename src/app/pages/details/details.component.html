<sub-header [title]="'Dettaglio'" [iconClass]="'bi bi-search'" [activateGoBack]="true" (onBack)="returnToDetails()"></sub-header>
<div class="pt-2 pb-4" style="margin: 1%!important;">
  
  @if(!loading){
    <div class="row d-flex align-items-center">
      <div class="col-3 d-flex justify-content-start">
        @if(!isDownloadingExport){
          <fieldset class="form-group" *ngIf="!isDownloadingExport">
            <button class="btn btn-secondary" (click)="downloadCsv()"><i class="bi bi-arrow-bar-down"></i> Esporta CSV</button>
          </fieldset>
        }@else{
          <div class="d-flex align-items-center justify-content-end">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Downloading...</span> 
            </div>
            <span class="ms-2">Downloading...</span> 
          </div>
        }    
      </div>
      <!-- TODO aggiungere filtro per tipo importo -->
      <div class="col-5"></div>
      <div class="col-2 d-flex justify-content-end">
        <button class="btn btn-primary" (click)="uploadCsv();"> <i class="bi bi-arrow-bar-up"></i> Carica CSV</button>
      </div>
      <div class="col-1 d-flex justify-content-end">
      </div>
      <div class="col-1 d-flex justify-content-end">
        <button class="btn btn-outline-primary" *ngIf="canSave && !alreadyRendicontato" (click)="saveCsv();"> <i class="bi bi-floppy"></i> Salva</button>
        <button class="btn btn-outline-primary" *ngIf="!canSave && !alreadyRendicontato" disabled> <i class="bi bi-floppy"></i> Salva</button>
      
      </div>
    </div>

    <div class="table-container mt-4">
      <table class="table table-bordered mt-3" id="dataTableOrdinario">
        <thead>
          <tr>
            <th class="title">
                Id Verbale
            </th>
            <th class="title"> 
              Stato Verbale 
            </th>
           
            <th class="title">
              Importo Pagato 
            </th>
            <th class="title">Data Pagamento</th>
            <th class="title"> 
              Tipo Importo
            </th>
            <th class="title"> 
              Importo Sanzione 
            </th>
            <th class="title">
                Spese di procedura 
            </th>
            <th class="title"> 
              Spese Postali 
            </th>
            <th class="title">
              Spese Comando 
            </th>
            <th class="title">
              Da Rimborsare 
            </th>
          </tr>
        </thead>
        
        <tbody>
          <tr *ngFor="let item of detailsData; index as i">
            <td class="col-auto text-end">{{item.id_verbale}}</td>
            <td class="col-auto text-end">{{item.stato}}</td>
            <td class="col-auto text-end" [ngClass]="">{{item.importo_pagato}} €
              @if(item.temp_importo_pagato!=null){
                | <span [ngClass]="{'evidenzia-diff' : item.temp_importo_pagato != item.importo_pagato}">{{item.temp_importo_pagato}} € </span>
              }
            </td>
            <td class="col-auto text-end">{{item.data_pagamento | date:'dd/MM/yyyy'}}</td>
            <td class="col-auto text-end">{{item.tipo}}</td>
            <td class="col-auto text-end">{{item.importo}} €
              @if(item.temp_importo!=null){
                | <span [ngClass]="{'evidenzia-diff' : item.temp_importo != item.importo}">{{item.temp_importo}} € </span>
              }
            </td>
            <td class="col-auto text-end">{{item.speseprocedura}} €
               @if(item.temp_speseprocedura!=null){
                | <span [ngClass]="{'evidenzia-diff' : item.temp_speseprocedura != item.speseprocedura}">{{item.temp_speseprocedura}} € </span>
              }
            </td>
            <td class="col-auto text-end">{{item.spesepostali}} €
              @if(item.temp_spesepostali!=null){
                | <span [ngClass]="{'evidenzia-diff' : item.temp_spesepostali != item.spesepostali}">{{item.temp_spesepostali}} € </span>
              }
            </td>
            <td class="col-auto text-end">{{item.spesecomando}} €
              @if(item.temp_spesecomando!=null){
                | <span [ngClass]="{'evidenzia-diff' : item.temp_spesecomando != item.spesecomando}">{{item.temp_spesecomando}} € </span>
              }
            </td>
            <td class="col-auto text-end">{{item.rimborso}} €
              @if(item.temp_rimborso!=null){
                | <span [ngClass]="{'evidenzia-diff' : item.temp_rimborso != item.rimborso}">{{item.temp_rimborso}} € </span>
              }
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  }@else {
    <div class="d-flex justify-content-center">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span> 
      </div>
      <span class="ms-2">Loading...</span>
    </div>
  }
  <!-- <div class="pagination-container mt-2">
    <button class="btn btn-secondary" (click)="prevPage();">Prev</button>
    <button class="btn btn-secondary" (click)="nextPage();">Next</button>
  </div> -->
</div>
